services:
  fraud-detection-api:
    build:
      context: ./api
      dockerfile: Dockerfile
    container_name: fraud-detection-api
    restart: unless-stopped
    environment:
      MLFLOW_TRACKING_URI: http://mlflow-server:5101
      MODEL_NAME: fraud_detection_xgboost
      MODEL_STAGE: None  # None, Staging, or Production
      PREPROCESSING_SERVICE_URL: http://preprocessing-service:8031
      LOG_LEVEL: INFO  # DEBUG, INFO, WARNING, ERROR
      # OpenTelemetry configuration
      OTEL_EXPORTER_OTLP_ENDPOINT: http://tempo:4317
      ENVIRONMENT: production
      # Sentry configuration (set your DSN here)
      SENTRY_DSN: https://example@o4510332793389056.ingest.us.sentry.io/4510332794634240
      SENTRY_TRACES_SAMPLE_RATE: "1.0"
      SENTRY_PROFILES_SAMPLE_RATE: "1.0"
      APP_VERSION: "1.0.0"
    ports:
      - "8000:8000"
    volumes:
      - ./logs:/app/logs  # Mount logs directory
    networks:
      - fraud-detection-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  fraud-detection-network:
    external: true
